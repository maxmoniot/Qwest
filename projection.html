<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwest - Mode Projection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }
        
        .projection-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
        }
        
        .projection-controls {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .projection-controls-left {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .projection-code {
            font-size: 20px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
        }
        
        .projection-info {
            display: flex;
            gap: 15px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .projection-info-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 16px;
            border-radius: 6px;
        }
        
        .projection-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .projection-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .projection-btn.btn-success {
            background: rgba(76, 175, 80, 0.8);
            border-color: rgba(76, 175, 80, 1);
        }
        
        .projection-btn.btn-danger {
            background: rgba(244, 67, 54, 0.8);
            border-color: rgba(244, 67, 54, 1);
        }
        
        .projection-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .projection-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }
        
        .projection-waiting {
            text-align: center;
        }
        
        .projection-waiting h1 {
            font-size: 72px;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .projection-waiting p {
            font-size: 32px;
            opacity: 0.9;
        }
        
        .projection-question-screen {
            background: white;
            color: #212121;
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 1400px;
            max-height: 85vh;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .projection-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        .projection-question-number {
            font-size: 20px;
            font-weight: 600;
            color: #757575;
        }
        
        .projection-timer {
            font-size: 28px;
            font-weight: 700;
            color: #2196F3;
        }
        
        .projection-question-image {
            margin-bottom: 20px;
            border-radius: 16px;
            overflow: hidden;
            flex-shrink: 0;
            max-height: 250px;
        }
        
        .projection-question-image img {
            width: 100%;
            height: 100%;
            max-height: 250px;
            object-fit: contain;
        }
        
        .projection-question-text {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
            flex-shrink: 0;
        }
        
        .projection-answers {
            display: grid;
            gap: 15px;
            flex: 1;
            min-height: 0;
            align-content: start;
        }
        
        .projection-answers.grid-2 {
            grid-template-columns: 1fr 1fr;
        }
        
        .projection-answers.grid-4 {
            grid-template-columns: 1fr 1fr;
        }
        
        .projection-answer {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 16px;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 4px solid #e0e0e0;
        }
        
        .projection-answer-label {
            width: 45px;
            height: 45px;
            background: #2196F3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .projection-order-instruction,
        .projection-freetext-instruction {
            font-size: 28px;
            color: #757575;
            margin-bottom: 20px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .projection-top3 {
            text-align: center;
            color: white;
        }
        
        .projection-top3 h1 {
            font-size: 64px;
            margin-bottom: 40px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .projection-podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 30px;
            margin-top: 60px;
        }
        
        .projection-podium-place {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            min-width: 250px;
            text-align: center;
        }
        
        .projection-podium-place.first {
            order: 2;
            transform: scale(1.1);
            background: rgba(255, 215, 0, 0.3);
        }
        
        .projection-podium-place.second {
            order: 1;
        }
        
        .projection-podium-place.third {
            order: 3;
        }
        
        .projection-podium-medal {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .projection-podium-name {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .projection-podium-score {
            font-size: 48px;
            font-weight: 700;
            color: #FFD700;
        }
        
        .projection-final {
            text-align: center;
            color: white;
        }
        
        .projection-final h1 {
            font-size: 72px;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .projection-final p {
            font-size: 36px;
            opacity: 0.9;
        }
        
        /* Classement g√©n√©ral entre les questions */
        .projection-ranking {
            width: 90%;
            max-width: 1200px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            color: white;
        }
        
        .projection-ranking-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .projection-ranking-header h1 {
            font-size: 56px;
            margin-bottom: 10px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .projection-ranking-header .question-info {
            font-size: 24px;
            opacity: 0.9;
        }
        
        .projection-ranking-content {
            display: flex;
            gap: 40px;
            flex: 1;
            min-height: 0;
        }
        
        /* Podium √† gauche */
        .projection-ranking-podium {
            flex: 0 0 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .ranking-podium-container {
            display: flex;
            align-items: flex-end;
            gap: 15px;
        }
        
        .ranking-podium-place {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            min-width: 120px;
        }
        
        .ranking-podium-place.first {
            order: 2;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 193, 7, 0.3));
            transform: scale(1.15);
            min-width: 140px;
        }
        
        .ranking-podium-place.second {
            order: 1;
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.3), rgba(158, 158, 158, 0.2));
        }
        
        .ranking-podium-place.third {
            order: 3;
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.3), rgba(139, 90, 43, 0.2));
        }
        
        .ranking-podium-medal {
            font-size: 50px;
            margin-bottom: 10px;
        }
        
        .ranking-podium-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 130px;
        }
        
        .ranking-podium-score {
            font-size: 28px;
            font-weight: 700;
            color: #FFD700;
        }
        
        .ranking-podium-place.second .ranking-podium-score {
            color: #C0C0C0;
        }
        
        .ranking-podium-place.third .ranking-podium-score {
            color: #CD7F32;
        }
        
        /* Liste des autres joueurs √† droite */
        .projection-ranking-list {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .ranking-list-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .ranking-list-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            transition: background 0.2s;
        }
        
        .ranking-list-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .ranking-list-position {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            margin-right: 15px;
        }
        
        .ranking-list-name {
            flex: 1;
            font-size: 20px;
            font-weight: 600;
        }
        
        .ranking-list-score {
            font-size: 22px;
            font-weight: 700;
            color: #FFD700;
        }
        
        .ranking-list-empty {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
            font-size: 18px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .projection-question-screen {
            animation: fadeIn 0.5s ease;
        }
        
        /* Modale de confirmation */
        .projection-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .projection-modal-overlay.active {
            display: flex;
        }
        
        .projection-modal {
            background: white;
            color: #212121;
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .projection-modal-icon {
            font-size: 64px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .projection-modal-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .projection-modal-message {
            font-size: 18px;
            text-align: center;
            color: #616161;
            margin-bottom: 30px;
        }
        
        .projection-modal-buttons {
            display: flex;
            gap: 15px;
        }
        
        .projection-modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .projection-modal-btn-secondary {
            background: #e0e0e0;
            color: #212121;
        }
        
        .projection-modal-btn-secondary:hover {
            background: #bdbdbd;
        }
        
        .projection-modal-btn-primary {
            background: #f44336;
            color: white;
        }
        
        .projection-modal-btn-primary:hover {
            background: #d32f2f;
        }
        
        /* Modale liste des participants */
        .projection-participants-modal {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .projection-participants-list {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }
        
        .projection-participant-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        .projection-participant-item.disconnected {
            opacity: 0.5;
            border-left-color: #f44336;
        }
        
        .projection-participant-name {
            font-size: 18px;
            font-weight: 600;
        }
        
        .projection-participant-status {
            font-size: 14px;
            color: #616161;
        }
    </style>
</head>
<body>
    <div class="projection-container">
        <div class="projection-controls">
            <div class="projection-controls-left">
                <div class="projection-code">Code : <span id="proj-code">Chargement...</span></div>
                <div class="projection-info">
                    <div class="projection-info-item" onclick="showParticipantsModal()" style="cursor: pointer;" title="Cliquez pour voir la liste">
                        üë• <span id="proj-players">0</span> connect√©s
                    </div>
                    <div class="projection-info-item">üìä Q <span id="proj-progress">0/0</span></div>
                </div>
                <button class="projection-btn btn-success" onclick="projStartGame()" id="proj-btn-start">‚ñ∂Ô∏è Lancer la partie</button>
                <button class="projection-btn" onclick="projPauseGame()" id="proj-btn-pause" disabled>‚è∏Ô∏è Pause</button>
                <button class="projection-btn" onclick="projNextQuestion()" id="proj-btn-next" disabled>‚è≠Ô∏è Question suivante</button>
                <button class="projection-btn" onclick="projResyncAll()" id="proj-btn-resync" disabled title="Forcer la resynchronisation de tous les √©l√®ves">üîÑ Resynchroniser</button>
                <button class="projection-btn" onclick="projEndGame()" id="proj-btn-end" disabled>‚èπÔ∏è Terminer</button>
            </div>
            <button class="projection-btn btn-danger" onclick="closeProjection()">‚ùå Quitter la projection</button>
        </div>
        <div class="projection-content" id="proj-content">
            <div class="projection-waiting">
                <h1>‚è≥ En attente</h1>
                <p>Cliquez sur "Lancer la partie" pour commencer</p>
            </div>
        </div>
    </div>
    
    <!-- Modale de confirmation -->
    <div class="projection-modal-overlay" id="confirm-modal">
        <div class="projection-modal">
            <div class="projection-modal-icon">‚ö†Ô∏è</div>
            <h3 class="projection-modal-title">Terminer la partie ?</h3>
            <p class="projection-modal-message">Voulez-vous vraiment terminer la partie maintenant ? Les r√©sultats finaux seront envoy√©s aux √©l√®ves.</p>
            <div class="projection-modal-buttons">
                <button class="projection-modal-btn projection-modal-btn-secondary" onclick="closeConfirmModal()">Annuler</button>
                <button class="projection-modal-btn projection-modal-btn-primary" onclick="confirmEndGame()">Confirmer</button>
            </div>
        </div>
    </div>
    
    <!-- Modale liste des participants -->
    <div class="projection-modal-overlay" id="participants-modal">
        <div class="projection-modal projection-participants-modal">
            <div class="projection-modal-icon">üë•</div>
            <h3 class="projection-modal-title">Participants connect√©s</h3>
            <div class="projection-participants-list" id="participants-list">
                <!-- Liste g√©n√©r√©e dynamiquement -->
            </div>
            <div class="projection-modal-buttons" style="margin-top: 30px;">
                <button class="projection-modal-btn projection-modal-btn-secondary" onclick="closeParticipantsModal()" style="width: 100%;">Fermer</button>
            </div>
        </div>
    </div>
    
    <script>
        // R√©cup√©rer les infos depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const playCode = urlParams.get('code');
        // totalQuestions sera mis √† jour dynamiquement quand les donn√©es arrivent
        let totalQuestions = parseInt(urlParams.get('total')) || 0;
        
        console.log('üìΩÔ∏è PROJECTION: D√©marrage avec code=' + playCode + ', total=' + totalQuestions);
        
        // Afficher le code imm√©diatement
        document.getElementById('proj-code').textContent = playCode || 'N/A';
        
        // √âtat de la projection
        let projectionState = {
            currentScreen: 'waiting',
            questionData: null,
            top3Data: null,
            questions: [],
            lastScreenKey: null,
            participants: []
        };
        
        // Fonctions de contr√¥le
        function projStartGame() {
            window.opener.startGame();
        }
        
        function projPauseGame() {
            window.opener.pauseGame();
        }
        
        function projNextQuestion() {
            console.log('üìΩÔ∏è PROJECTION: Clic sur Question suivante');
            if (window.opener && window.opener.nextQuestion) {
                console.log('üìΩÔ∏è PROJECTION: Appel de window.opener.nextQuestion()');
                window.opener.nextQuestion();
            } else {
                console.error('üìΩÔ∏è PROJECTION: window.opener.nextQuestion() non disponible !');
                alert('‚ùå Impossible de passer √† la question suivante. Assurez-vous que le panneau de pilotage est ouvert.');
            }
        }
        
        function projEndGame() {
            // Afficher la modale de confirmation locale
            document.getElementById('confirm-modal').classList.add('active');
        }
        
        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.remove('active');
        }
        
        function confirmEndGame() {
            // Fermer la modale locale
            closeConfirmModal();
            
            // Appeler la fonction dans l'onglet parent qui va g√©rer la vraie fin
            if (window.opener && window.opener.executeEndGameFromProjection) {
                window.opener.executeEndGameFromProjection();
            }
        }
        
        // Resynchroniser tous les √©l√®ves
        async function projResyncAll() {
            if (!confirm('üîÑ Forcer la resynchronisation ?\n\nCela va forcer l\'affichage des r√©sultats actuels pour tous les √©l√®ves.\nUtilisez ceci uniquement si les √©l√®ves sont bloqu√©s.')) {
                return;
            }
            
            try {
                const response = await fetch('php/control.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        action: 'force_question_complete',
                        playCode: playCode,
                        questionIndex: projectionState.currentQuestion
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('‚úÖ Resynchronisation forc√©e avec succ√®s');
                    alert('‚úÖ Resynchronisation effectu√©e !\nLes √©l√®ves devraient maintenant voir les r√©sultats.');
                } else {
                    alert('‚ùå Erreur lors de la resynchronisation');
                }
                
            } catch (error) {
                console.error('‚ùå Erreur resynchronisation:', error);
                alert('‚ùå Erreur lors de la resynchronisation');
            }
        }
        
        function showParticipantsModal() {
            const modal = document.getElementById('participants-modal');
            const list = document.getElementById('participants-list');
            
            // G√©n√©rer la liste
            let html = '';
            if (projectionState.participants.length === 0) {
                html = '<p style="text-align: center; color: #616161; padding: 20px;">Aucun participant pour le moment</p>';
            } else {
                projectionState.participants.forEach(participant => {
                    const isConnected = participant.connected;
                    html += '<div class="projection-participant-item ' + (isConnected ? '' : 'disconnected') + '">';
                    html += '<div>';
                    html += '<div class="projection-participant-name">' + participant.nickname + '</div>';
                    html += '<div class="projection-participant-status">';
                    html += isConnected ? 'üü¢ Connect√©' : 'üî¥ D√©connect√©';
                    html += ' ‚Ä¢ ' + participant.score + ' pts';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                });
            }
            
            list.innerHTML = html;
            modal.classList.add('active');
        }
        
        function closeParticipantsModal() {
            document.getElementById('participants-modal').classList.remove('active');
        }
        
        function closeProjection() {
            window.close();
        }
        
        // Fonction de mise √† jour appel√©e depuis la fen√™tre parent
        window.updateProjection = function(data) {
            console.log('üìΩÔ∏è PROJECTION: Donn√©es re√ßues', data);
            
            const content = document.getElementById('proj-content');
            const btnStart = document.getElementById('proj-btn-start');
            const btnPause = document.getElementById('proj-btn-pause');
            const btnNext = document.getElementById('proj-btn-next');
            const btnResync = document.getElementById('proj-btn-resync');
            const btnEnd = document.getElementById('proj-btn-end');
            const playersCount = document.getElementById('proj-players');
            const progress = document.getElementById('proj-progress');
            
            // Mettre √† jour le nombre total de questions d√®s qu'on le re√ßoit
            if (data.totalQuestions && data.totalQuestions > 0) {
                totalQuestions = data.totalQuestions;
                console.log('üìΩÔ∏è PROJECTION: Total questions mis √† jour:', totalQuestions);
            }
            
            // Stocker les questions si pr√©sentes
            if (data.questions && data.questions.length > 0) {
                projectionState.questions = data.questions;
            }
            
            // Stocker la liste des participants
            if (data.participants) {
                projectionState.participants = data.participants;
            }
            
            // Stocker la question courante pour la resync
            if (data.currentQuestion !== undefined) {
                projectionState.currentQuestion = data.currentQuestion;
            }
            
            // Mise √† jour des infos (sans clignotement)
            if (playersCount.textContent !== String(data.playersCount || 0)) {
                playersCount.textContent = data.playersCount || 0;
            }
            const newProgress = (data.currentQuestion + 1) + '/' + totalQuestions;
            if (progress.textContent !== newProgress) {
                progress.textContent = newProgress;
            }
            
            // Mise √† jour des boutons
            if (data.state === 'waiting') {
                btnStart.disabled = false;
                btnPause.disabled = true;
                btnNext.disabled = true;
                btnResync.disabled = true;
                btnEnd.disabled = true;
            } else {
                btnStart.disabled = true;
                btnPause.disabled = false;
                // Activer "Question suivante" pendant toute la partie (pas seulement en mode manuel)
                btnNext.disabled = false;
                btnResync.disabled = false;
                btnEnd.disabled = false;
                
                // Mettre √† jour le texte du bouton pause/reprendre
                if (data.paused) {
                    btnPause.innerHTML = '‚ñ∂Ô∏è Reprendre';
                } else {
                    btnPause.innerHTML = '‚è∏Ô∏è Pause';
                }
            }
            
            console.log('üìΩÔ∏è PROJECTION: Affichage √©cran -', data.screen);
            
            // Ne mettre √† jour le contenu QUE si l'√©cran ou la question a chang√©
            const screenKey = data.screen + '-' + (data.currentQuestion || 0);
            if (projectionState.lastScreenKey !== screenKey) {
                projectionState.lastScreenKey = screenKey;
                
                // Affichage selon le type
                if (data.screen === 'question' && data.currentQuestion >= 0) {
                    const question = projectionState.questions[data.currentQuestion];
                    if (question) {
                        console.log('üìΩÔ∏è PROJECTION: Rendu question', question);
                        content.innerHTML = renderQuestion(question, data.currentQuestion, totalQuestions);
                    }
                } else if (data.screen === 'ranking' && data.allPlayers) {
                    // NOUVEAU : Affichage du classement g√©n√©ral
                    console.log('üìΩÔ∏è PROJECTION: Rendu classement g√©n√©ral', data.allPlayers);
                    content.innerHTML = renderRanking(data.allPlayers, data.currentQuestion, totalQuestions);
                } else if (data.screen === 'top3' && data.top3) {
                    console.log('üìΩÔ∏è PROJECTION: Rendu top3', data.top3);
                    content.innerHTML = renderTop3(data.top3);
                } else if (data.screen === 'final' && data.allPlayers) {
                    console.log('üìΩÔ∏è PROJECTION: Rendu final avec classement');
                    content.innerHTML = renderFinalRanking(data.allPlayers);
                } else if (data.screen === 'final') {
                    console.log('üìΩÔ∏è PROJECTION: Rendu final');
                    content.innerHTML = renderFinal();
                } else {
                    console.log('üìΩÔ∏è PROJECTION: En attente');
                    content.innerHTML = '<div class="projection-waiting"><h1>‚è≥ En attente</h1><p>Cliquez sur "Lancer la partie" pour commencer</p></div>';
                }
            }
        };
        
        function renderQuestion(question, index, total) {
            let answersHTML = '';
            let answersClass = 'grid-4';
            
            if (question.type === 'truefalse') {
                answersClass = 'grid-2';
            }
            
            if (question.type === 'multiple' || question.type === 'truefalse') {
                answersHTML = '<div class="projection-answers ' + answersClass + '">';
                question.answers.forEach((answer, i) => {
                    answersHTML += '<div class="projection-answer">';
                    answersHTML += '<div class="projection-answer-label">' + String.fromCharCode(65 + i) + '</div>';
                    answersHTML += '<div>' + answer.text + '</div>';
                    answersHTML += '</div>';
                });
                answersHTML += '</div>';
            } else if (question.type === 'order') {
                answersHTML = '<p class="projection-order-instruction">Remettre les √©l√©ments dans le bon ordre</p>';
                answersHTML += '<div class="projection-answers">';
                question.answers.forEach((answer, i) => {
                    answersHTML += '<div class="projection-answer">';
                    answersHTML += '<div class="projection-answer-label">' + (i + 1) + '</div>';
                    answersHTML += '<div>' + answer.text + '</div>';
                    answersHTML += '</div>';
                });
                answersHTML += '</div>';
            } else if (question.type === 'freetext') {
                answersHTML = '<p class="projection-freetext-instruction">Les √©l√®ves doivent saisir leur r√©ponse</p>';
            }
            
            let html = '<div class="projection-question-screen">';
            html += '<div class="projection-question-header">';
            html += '<div class="projection-question-number">Question ' + (index + 1) + ' / ' + total + '</div>';
            html += '<div class="projection-timer">‚è±Ô∏è ' + question.time + 's</div>';
            html += '</div>';
            
            if (question.imageUrl) {
                html += '<div class="projection-question-image">';
                html += '<img src="' + question.imageUrl + '" alt="Image de la question">';
                html += '</div>';
            }
            
            html += '<div class="projection-question-text">' + question.question + '</div>';
            html += answersHTML;
            html += '</div>';
            
            return html;
        }
        
        function renderTop3(players) {
            if (!players || players.length === 0) {
                return '<div class="projection-waiting"><h1>üìä R√©sultats</h1><p>Aucun score pour le moment</p></div>';
            }
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const classes = ['first', 'second', 'third'];
            
            let html = '<div class="projection-top3"><h1>üèÜ Top 3</h1><div class="projection-podium">';
            
            players.slice(0, 3).forEach((player, index) => {
                html += '<div class="projection-podium-place ' + classes[index] + '">';
                html += '<div class="projection-podium-medal">' + medals[index] + '</div>';
                html += '<div class="projection-podium-name">' + player.nickname + '</div>';
                html += '<div class="projection-podium-score">' + player.score + ' pts</div>';
                html += '</div>';
            });
            
            html += '</div></div>';
            return html;
        }
        
        function renderFinal() {
            return '<div class="projection-final"><h1>üéâ Partie termin√©e !</h1><p>Bravo √† tous les participants !</p></div>';
        }
        
        function renderRanking(players, questionIndex, total) {
            if (!players || players.length === 0) {
                return '<div class="projection-waiting"><h1>üìä Classement</h1><p>Aucun score pour le moment</p></div>';
            }
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const classes = ['first', 'second', 'third'];
            const top3 = players.slice(0, 3);
            const others = players.slice(3);
            
            let html = '<div class="projection-ranking">';
            
            // Header
            html += '<div class="projection-ranking-header">';
            html += '<h1>üìä Classement g√©n√©ral</h1>';
            html += '<div class="question-info">Apr√®s la question ' + (questionIndex + 1) + ' / ' + total + '</div>';
            html += '</div>';
            
            html += '<div class="projection-ranking-content">';
            
            // Podium top 3
            html += '<div class="projection-ranking-podium">';
            html += '<div class="ranking-podium-container">';
            top3.forEach((player, index) => {
                html += '<div class="ranking-podium-place ' + classes[index] + '">';
                html += '<div class="ranking-podium-medal">' + medals[index] + '</div>';
                html += '<div class="ranking-podium-name">' + escapeHtml(player.nickname) + '</div>';
                html += '<div class="ranking-podium-score">' + (player.score || 0) + '</div>';
                html += '</div>';
            });
            html += '</div>';
            html += '</div>';
            
            // Liste des autres joueurs
            html += '<div class="projection-ranking-list">';
            html += '<div class="ranking-list-title">Autres participants</div>';
            
            if (others.length === 0) {
                html += '<div class="ranking-list-empty">Pas d\'autres participants</div>';
            } else {
                others.forEach((player, index) => {
                    html += '<div class="ranking-list-item">';
                    html += '<div class="ranking-list-position">' + (index + 4) + '</div>';
                    html += '<div class="ranking-list-name">' + escapeHtml(player.nickname) + '</div>';
                    html += '<div class="ranking-list-score">' + (player.score || 0) + ' pts</div>';
                    html += '</div>';
                });
            }
            
            html += '</div>';
            html += '</div>';
            html += '</div>';
            
            return html;
        }
        
        function renderFinalRanking(players) {
            if (!players || players.length === 0) {
                return '<div class="projection-final"><h1>üéâ Partie termin√©e !</h1><p>Bravo √† tous les participants !</p></div>';
            }
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const classes = ['first', 'second', 'third'];
            const top3 = players.slice(0, 3);
            const others = players.slice(3);
            
            let html = '<div class="projection-ranking">';
            
            // Header
            html += '<div class="projection-ranking-header">';
            html += '<h1>üéâ Classement final</h1>';
            html += '<div class="question-info">Bravo √† tous les participants !</div>';
            html += '</div>';
            
            html += '<div class="projection-ranking-content">';
            
            // Podium top 3
            html += '<div class="projection-ranking-podium">';
            html += '<div class="ranking-podium-container">';
            top3.forEach((player, index) => {
                html += '<div class="ranking-podium-place ' + classes[index] + '">';
                html += '<div class="ranking-podium-medal">' + medals[index] + '</div>';
                html += '<div class="ranking-podium-name">' + escapeHtml(player.nickname) + '</div>';
                html += '<div class="ranking-podium-score">' + (player.score || 0) + '</div>';
                html += '</div>';
            });
            html += '</div>';
            html += '</div>';
            
            // Liste des autres joueurs
            html += '<div class="projection-ranking-list">';
            html += '<div class="ranking-list-title">Autres participants</div>';
            
            if (others.length === 0) {
                html += '<div class="ranking-list-empty">Pas d\'autres participants</div>';
            } else {
                others.forEach((player, index) => {
                    html += '<div class="ranking-list-item">';
                    html += '<div class="ranking-list-position">' + (index + 4) + '</div>';
                    html += '<div class="ranking-list-name">' + escapeHtml(player.nickname) + '</div>';
                    html += '<div class="ranking-list-score">' + (player.score || 0) + ' pts</div>';
                    html += '</div>';
                });
            }
            
            html += '</div>';
            html += '</div>';
            html += '</div>';
            
            return html;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
